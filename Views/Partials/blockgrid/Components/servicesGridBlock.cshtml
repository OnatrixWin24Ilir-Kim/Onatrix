@using Umbraco.Cms.Core.Models
@using Umbraco.Cms.Core.Models.Blocks
@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage<Umbraco.Cms.Core.Models.Blocks.BlockListItem>
@{
    var sectionTitle = Model.Content.Value<string>("sectionTitle");
    var services = Model.Content.Value<BlockListModel>("services");
}

<section class="services-section">
    <div class="container">
        @if (!string.IsNullOrEmpty(sectionTitle))
        {
            <h2 class="section-title">@sectionTitle</h2>
        }
        
        @if (services != null && services.Any())
        {
            <div class="services-grid">
                @foreach (var serviceBlock in services)
                {
                    var serviceTitle = serviceBlock.Content.Value<string>("serviceTitle");
                    var serviceDescription = serviceBlock.Content.Value<string>("serviceDescription");
                    var serviceLink = serviceBlock.Content.Value<IPublishedContent>("serviceLink");
                    
                    // Try different methods to get the image
                    string imageUrl = "";
                    var img1 = serviceBlock.Content.Value<IPublishedContent>("serviceImage");
                    if (img1 != null) { imageUrl = img1.Url(); }
                    
                    if (string.IsNullOrEmpty(imageUrl))
                    {
                        var img2 = serviceBlock.Content.Value<MediaWithCrops>("serviceImage");
                        if (img2 != null) { imageUrl = img2.Url(); }
                    }
                    
                    if (string.IsNullOrEmpty(imageUrl))
                    {
                        var img3 = serviceBlock.Content.Value<IEnumerable<MediaWithCrops>>("serviceImage");
                        if (img3 != null && img3.Any()) { imageUrl = img3.FirstOrDefault()?.Url() ?? ""; }
                    }
                    
                    var linkUrl = serviceLink?.Url() ?? "#";
                    
                    <a href="@linkUrl" class="service-card">
                        @if (!string.IsNullOrEmpty(imageUrl))
                        {
                            <div class="service-image">
                                <img src="@imageUrl" alt="@serviceTitle">
                            </div>
                        }
                        <h3>@serviceTitle</h3>
                        <p>@serviceDescription</p>
                    </a>
                }
            </div>
        }
    </div>
</section>